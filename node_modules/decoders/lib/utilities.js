'use strict'

exports.__esModule = true
exports.fail = void 0
exports.instanceOf = instanceOf
exports.lazy = lazy
exports.never = never
exports.prep = prep

var _annotate = require('../annotate')

var _Decoder = require('../Decoder')

function instanceOf(klass) {
  return (0, _Decoder.define)(function (blob, ok, err) {
    return blob instanceof klass ? ok(blob) : err('Must be ' + klass.name + ' instance')
  })
}

function lazy(decoderFn) {
  return (0, _Decoder.define)(function (blob) {
    return decoderFn().decode(blob)
  })
}

function prep(mapperFn, decoder) {
  return (0, _Decoder.define)(function (originalInput, _, err) {
    var blob

    try {
      blob = mapperFn(originalInput)
    } catch (e) {
      return err((0, _annotate.annotate)(originalInput, e.message))
    }

    var r = decoder.decode(blob)
    return r.ok ? r : err((0, _annotate.annotate)(originalInput, r.error.text))
  })
}

function never(msg) {
  return (0, _Decoder.define)(function (_, __, err) {
    return err(msg)
  })
}

var fail = never
exports.fail = fail
