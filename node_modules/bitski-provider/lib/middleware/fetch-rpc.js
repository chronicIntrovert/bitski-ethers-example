"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.createFetchRpcMiddleware = void 0;
const json_rpc_engine_1 = require("json-rpc-engine");
const request_context_1 = require("../utils/request-context");
const fetch_1 = require("../utils/fetch");
const createFetchRpcMiddleware = () => {
    return (0, json_rpc_engine_1.createAsyncMiddleware)(async (req, res) => {
        const { config, chain } = (0, request_context_1.getRequestContext)(req);
        const headers = Object.assign({}, config.additionalHeaders);
        res.result = await (0, fetch_1.fetchJsonRpcWithRetry)(config.fetch, 5, chain.rpcUrls[0], {
            method: 'POST',
            headers,
            body: {
                id: req.id,
                jsonrpc: req.jsonrpc,
                method: req.method,
                params: req.params,
            },
        });
    });
};
exports.createFetchRpcMiddleware = createFetchRpcMiddleware;
//# sourceMappingURL=fetch-rpc.js.map